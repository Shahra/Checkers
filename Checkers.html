<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <style>
        img {
            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            user-select: none;
            /* Required to make elements draggable in old WebKit */
            -khtml-user-drag: element;
            -webkit-user-drag: element;
        }

        #canvas, img {
            position: absolute;
        }
        #canvas {
            border: 5px solid black;
            background-size: 100%;
        }
    </style>
</head>
<body>


    <canvas id="canvas" width="512" height="512">Canvas not supported!</canvas>

    <script>
        var boardString = 'ABABABAB;BABABABA;AAAAAAAA;AAAAAAAA;AAAAAAAA;AAAAAAAA;AWAWAWAW;WAWAWAWA';
        var listOfValidMoves;

        function isInsideBoard(x, y) {
            if(x >= 0 && x < 8 && y >= 0 && y < 8) return true;
            else return false;
        }
        function validMoves(board, c, x, y, ctx, eaten) {
            listOfValidMoves = [];
            //gledamo za c = W

            if(isInsideBoard(x - 1, y - 1)) {
                if(c === 'W') {
                    if(board[x - 1][y - 1] === 'A' && eaten.length === 0) {
                        ctx.fillStyle = "lime";
                        ctx.fillRect((y - 1) * 64, (x - 1) * 64, 64, 64);
                        listOfValidMoves.push([x - 1, y - 1])
                    }
                    else if(board[x - 1][y - 1] === 'B') {
                        if(isInsideBoard(x - 2, y - 2) && board[x - 2][y - 2] === 'A') {
                            ctx.fillStyle = "lime";
                            ctx.fillRect((y - 2) * 64, (x - 2) * 64, 64, 64);
                            eaten.push([x - 1, y - 1]);
                            validMoves(board, c, x - 2, y - 2, ctx, eaten);
                            listOfValidMoves.push([x - 2, y - 2, eaten])
                        }
                    }
                }
            }
            if(isInsideBoard(x - 1, y + 1)) {
                if(c === 'W') {
                    if(board[x - 1][y + 1] === 'A' && eaten.length === 0) {
                        ctx.fillStyle = "lime";
                        ctx.fillRect((y + 1) * 64, (x - 1) * 64, 64, 64);
                        listOfValidMoves.push([x - 1, y + 1])
                    }
                    else if(board[x - 1][y + 1] === 'B') {
                        if(isInsideBoard(x - 2, y + 2) && board[x - 2][y + 2] === 'A'){
                            ctx.fillStyle = "lime";
                            ctx.fillRect((y + 2) * 64, (x - 2) * 64, 64, 64);
                            eaten.push([x - 1, y + 1]);
                            validMoves(board, c, x - 2, y + 2, ctx, eaten);
                            listOfValidMoves.push([x - 2, y + 2, eaten])
                        }
                    }
                }
            }
            console.log(listOfValidMoves);
        }

        $( document ).ready( function() {
            var selectedPiece = null, selectedPieceX = null, selectedPieceY = null;
            var cnv = $("#canvas").get(0); var ctx = cnv.getContext("2d"); var rect = canvas.getBoundingClientRect();
            $('#canvas').on('mousedown', function(event) {
                //Ako stisnemo na neko polje ploce, prvo provjeravamo da li smo oznacili neku figuru
                //zatim racunamo nove koordinate, provjeravamo da li se
                if(selectedPiece !== null) {
                    var x = Math.floor((event.clientY - rect.top) / 64),
                        y = Math.floor((event.clientX - rect.left) / 64);
                    if(x === 8) x = 7;
                    if(y === 8) y = 7;
                    //try to move piece from position (selectedPieceX, selectedPieceY) -> (x, y)
                    console.log(board);
                    board[x][y] = board[selectedPieceX][selectedPieceY];
                    board[selectedPieceX][selectedPieceY] = 'A';
                    console.log(board);
                    selectedPiece.css({
                        left: y * 64 + 13, top: x * 64 + 13
                    }).css('background-color', 'transparent');
                    selectedPiece = null; selectedPieceX = null; selectedPieceY = null;
                    for(var i = 0; i < 8; i++) {
                        for(var j = 0; j < 8; j++) {
                            if((i + j) % 2 === 0) ctx.fillStyle = "#ABCDEF";
                            else ctx.fillStyle = "blue";
                            ctx.fillRect(i * 64, j * 64, 64, 64);
                        }
                    }
                }
            });

            //Crtanje ploce
            for(var i = 0; i < 8; i++) {
                for(var j = 0; j < 8; j++) {
                    if((i + j) % 2 === 0) ctx.fillStyle = "#ABCDEF";
                    else ctx.fillStyle = "blue";
                    ctx.fillRect(i * 64, j * 64, 64, 64);
                }
            }

            //Crtanje figurica
            var board = boardString.split(';');
            for(var i = 0; i < board.length; i++){
                board[i] = board[i].split('');
            }
            for(var i = 0; i < board.length; i++) {
                for(var j = 0; j < board[i].length; j++) {
                    if(board[i][j] === 'B' || board[i][j] === 'W') {
                        var img;
                        if(board[i][j] === 'W') {
                            img = $('<img src="WhitePawn.png" alt="white_pawn"/>');
                        }
                        else if(board[i][j] === 'B') {
                            img = $('<img src="BlackPawn.png" alt="black_pawn"/>');
                        }
                        img
                            .css({
                                top: i * 64 + 13, left: j * 64 + 13
                            }).on('mousedown', function(event) {
                                if(selectedPiece !== null) {
                                    selectedPiece.css('background-color', 'transparent');
                                    for(var i = 0; i < 8; i++) {
                                        for(var j = 0; j < 8; j++) {
                                            if((i + j) % 2 === 0) ctx.fillStyle = "#ABCDEF";
                                            else ctx.fillStyle = "blue";
                                            ctx.fillRect(i * 64, j * 64, 64, 64);
                                        }
                                    }
                                }
                                selectedPiece = $(this).css('background-color', 'yellow');
                                selectedPieceX = ($(this).position().top - 13) / 64;
                                selectedPieceY = ($(this).position().left - 13) / 64;
                                validMoves(board, 'W', selectedPieceX, selectedPieceY, ctx, []);
                            });
                        $('body').append(img);
                    }
                }
            }
        });
    </script>
</body>
</html>
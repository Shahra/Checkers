<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkers</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <style>
        img {
            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            user-select: none;
        }

        #canvas, img {
            position: absolute;
        }
        #canvas {
            border: 5px solid black;
            background-size: 100%;
        }
    </style>
</head>
<body>

    <canvas id="canvas" width="512" height="512">Canvas not supported!</canvas>

    <script>
        $( document ).ready( function() {
            var boardString = 'ABABABAB;BABABABA;ABABABAB;AAAAAAAA;AAAAAAAA;WAWAWAWA;AWAWAWAW;WAWAWAWA';
            var cnv = $("#canvas").get(0); var ctx = cnv.getContext("2d"); var rect = canvas.getBoundingClientRect();
            var selectedPiece = null, selectedPieceX = null, selectedPieceY = null;
            var listOfValidMoves, pieceWidth = 64, pieceOffset = 13;

            function getBoard(boardString) {
                var board = boardString.split(';');
                for(var i = 0; i < board.length; i++){
                    board[i] = board[i].split('');
                }
                return board;
            }
            function drawBoard(ctx) {
                for(var i = 0; i < 8; i++) {
                    for(var j = 0; j < 8; j++) {
                        if((i + j) % 2 === 0) ctx.fillStyle = "#ABCDEF";
                        else ctx.fillStyle = "blue";
                        ctx.fillRect(i * 64, j * 64, 64, 64);
                    }
                }
            }

            function initializeBoard(board, ctx) {
                //Draw board.
                drawBoard(ctx);

                //Initialize pieces.
                for(var i = 0; i < board.length; i++) {
                    for(var j = 0; j < board[i].length; j++) {
                        if(board[i][j] === 'B' || board[i][j] === 'W') {
                            var img;
                            if(board[i][j] === 'W') {
                                img = $('<img src="WhitePawn.png" alt="white_pawn"/>');
                            }
                            else if(board[i][j] === 'B') {
                                img = $('<img src="BlackKing.png" alt="black_pawn"/>');
                            }
                            img
                                .on('mousedown', function() {
                                    if(selectedPiece !== null) {
                                        selectedPiece.css('background-color', 'transparent');
                                        drawBoard(ctx);
                                    }
                                    selectedPiece = $(this).css('background-color', 'yellow');
                                    selectedPieceX = ($(this).position().top - pieceOffset) / 64;
                                    selectedPieceY = ($(this).position().left - pieceOffset) / 64;
                                    validMoves(ctx, board, selectedPieceX, selectedPieceY, board[selectedPieceX][selectedPieceY], []);
                                })
                                .css({
                                    top: i * pieceWidth + pieceOffset, left: j * pieceWidth + pieceOffset
                                });
                            $('body').append(img);
                        }
                    }
                }
            }

            function validCoordinates(x, y) {
                if(x >= 0 && x < 8 && y >= 0 && y < 8) return true;
                else return false;
            }
            function validMoves(ctx, board, x, y, c, eaten) {
                listOfValidMoves = [];

                if(!validCoordinates(x, y)) {
                    return false;
                }

                if(validCoordinates(x - 1, y - 1) && c === 'W') {
                    if(board[x - 1][y - 1] === 'A' && eaten.length === 0) {
                        ctx.fillStyle = "lime";
                        ctx.fillRect((y - 1) * 64, (x - 1) * 64, 64, 64);
                        listOfValidMoves.push([x - 1, y - 1, []])
                    }
                    else if(board[x - 1][y - 1] === 'B') {
                        if(validCoordinates(x - 2, y - 2) && board[x - 2][y - 2] === 'A') {
                            ctx.fillStyle = "lime";
                            ctx.fillRect((y - 2) * 64, (x - 2) * 64, 64, 64);
                            eaten.push([x - 1, y - 1]);
                            validMoves(ctx, board, x - 2, y - 2, c, eaten);
                            listOfValidMoves.push([x - 2, y - 2, eaten])
                        }
                    }
                }

                if(validCoordinates(x - 1, y + 1) && c === 'W') {
                    if(board[x - 1][y + 1] === 'A' && eaten.length === 0) {
                        ctx.fillStyle = "lime";
                        ctx.fillRect((y + 1) * 64, (x - 1) * 64, 64, 64);
                        listOfValidMoves.push([x - 1, y + 1, []])
                    }
                    else if(board[x - 1][y + 1] === 'B') {
                        if(validCoordinates(x - 2, y + 2) && board[x - 2][y + 2] === 'A'){
                            ctx.fillStyle = "lime";
                            ctx.fillRect((y + 2) * 64, (x - 2) * 64, 64, 64);
                            eaten.push([x - 1, y + 1]);
                            validMoves(ctx, board, x - 2, y + 2, c, eaten);
                            listOfValidMoves.push([x - 2, y + 2, eaten])
                        }
                    }
                }

                if(validCoordinates(x + 1, y - 1) && c === 'B') {
                    if(board[x + 1][y - 1] === 'A' && eaten.length === 0) {
                        ctx.fillStyle = "lime";
                        ctx.fillRect((y - 1) * 64, (x + 1) * 64, 64, 64);
                        listOfValidMoves.push([x + 1, y - 1, []])
                    }
                    else if(board[x + 1][y - 1] === 'W') {
                        if(validCoordinates(x + 2, y - 2) && board[x + 2][y - 2] === 'A') {
                            ctx.fillStyle = "lime";
                            ctx.fillRect((y - 2) * 64, (x + 2) * 64, 64, 64);
                            eaten.push([x + 1, y - 1]);
                            validMoves(ctx, board, x + 2, y - 2, c, eaten);
                            listOfValidMoves.push([x + 2, y - 2, eaten])
                        }
                    }
                }

                if(validCoordinates(x + 1, y + 1) && c === 'B') {
                    if(board[x + 1][y + 1] === 'A' && eaten.length === 0) {
                        ctx.fillStyle = "lime";
                        ctx.fillRect((y + 1) * 64, (x + 1) * 64, 64, 64);
                        listOfValidMoves.push([x + 1, y + 1, []])
                    }
                    else if(board[x + 1][y + 1] === 'W') {
                        if(validCoordinates(x + 2, y + 2) && board[x + 2][y + 2] === 'A'){
                            ctx.fillStyle = "lime";
                            ctx.fillRect((y + 2) * 64, (x + 2) * 64, 64, 64);
                            eaten.push([x + 1, y + 1]);
                            validMoves(ctx, board, x + 2, y + 2, c, eaten);
                            listOfValidMoves.push([x + 2, y + 2, eaten])
                        }
                    }
                }

                return listOfValidMoves;
            }

            board = getBoard(boardString);
            initializeBoard(board, ctx);

            $('#canvas')
                .on('mousedown', function(event) {
                    if(selectedPiece !== null) {
                        var x = Math.floor((event.clientY - rect.top) / 64),
                            y = Math.floor((event.clientX - rect.left) / 64);

                        //This is here to make sure that pieces don't go over the board.
                        if(x === 8) x = 7;
                        if(y === 8) y = 7;

                        //try to move piece from position (selectedPieceX, selectedPieceY) -> (x, y)
                        board[x][y] = board[selectedPieceX][selectedPieceY];
                        board[selectedPieceX][selectedPieceY] = 'A';

                        selectedPiece
                            .css({
                                left: y * pieceWidth + pieceOffset, top: x * pieceWidth + pieceOffset
                            })
                            .css('background-color', 'transparent');
                        selectedPiece = null; selectedPieceX = null; selectedPieceY = null;
                        drawBoard(ctx);
                    }
                });
        });
    </script>
</body>
</html>